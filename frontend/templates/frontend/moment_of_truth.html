{% extends 'base/frontendbase.html' %}
{% block content %}
<div class="page-header header-filter header-small" data-parallax="true"
    style="background-image: url('{{settings.primary_image.url}}');">
    <div class="container">
        <div class="row">
            <div class="col-md-8 ml-auto mr-auto text-center">
                <h1 class="big">MOMENT OF TRUTH</h1>
                <!-- <h4>A pictorial collection of Dominion Partners Activies </h4> -->
            </div>
        </div>
    </div>
</div>
<div class="container-fluid">
    <div class="main main-raised" style="">
        <div class="uk-padding-small" id="momentoftruth">

        </div>

    </div>
</div>

<script>

    {
        (function ($) {
            var pageStatus = null;
            var progress = null;
            var animationInterval = 33;

            window.document.addEventListener("readystatechange", function () {
                if (document.readyState == "complete") {
                    pageStatus = "complete";
                }
                else {
                    progress++

                    $('#progress').progress({
                        percent: progress
                    });
                }
            }, false);


            function updateProgress() {
                if (pageStatus == "complete") {
                    $('#progress').progress({
                        percent: 100
                    });
                    setTimeout(function () {
                        $('#page-ready-cover').addClass('uk-transition-fade uk-transition-slow')
                        $('#page-ready-cover').transition('fade')
                    }, 700);
                }
                else {
                    if (progress == null) {
                        progress = 1;
                    }

                    progress = progress + 1;
                    if (progress >= 0 && progress <= 30) {
                        animationInterval += 1;
                        $('#progress').progress({
                            percent: progress
                        });
                    }
                    else if (progress > 30 && progress <= 60) {
                        animationInterval += 2;
                        $('#progress').progress({
                            percent: progress
                        });
                    }
                    else if (progress > 60 && progress <= 80) {
                        animationInterval += 3;
                        $('#progress').progress({
                            percent: progress
                        });
                    }
                    else if (progress > 80 && progress <= 90) {
                        animationInterval += 4;
                        $('#progress').progress({
                            percent: progress
                        });
                    }
                    else if (progress > 90 && progress <= 95) {
                        animationInterval += 80;
                        $('#progress').progress({
                            percent: progress
                        });
                    }
                    else if (progress > 95 && progress <= 99) {
                        animationInterval += 150;
                        document.getElementById("pageLoader").innerHTML = progress;
                    }
                    else if (progress >= 100) {
                        $('#progress').progress({
                            percent: progress
                        });
                    }
                    setTimeout(updateProgress, animationInterval);
                }
            }

            var intervalObject_1 = setInterval(function () {
                var element = document.querySelector("body");

                if (element != undefined) {
                    clearInterval(intervalObject_1);

                    updateProgress();
                }
            }, 50);
            $.ajax({
                beforeSend: function () {
                    $('#momentoftruth').append(inline_loader_small_center);


                },
                complete: function () {
                    $('#momentoftruth').children('.loading').remove()
                },
                type: 'get',
                url: "{% url 'moment_of_truth_content' %}",
                data: {
                    'csrfmiddlewaretoken': window.CSRF_TOKEN,
                    'page':'{{page}}'
                },
                success: function (response) {
                    $('#momentoftruth').append(response.content);
                    progress = 100

                },
                error: function (xhr, status, error) {
                    alert('there was an error')
                }
            });
        }(jQuery))
    }

</script>
{% endblock content %}